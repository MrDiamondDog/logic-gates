import Utils from"./utilities.js";const canvas=document.getElementById("canvas"),ctx=(canvas.width=window.innerWidth,canvas.height=window.innerHeight-50,canvas.getContext("2d"));function Update(){requestAnimationFrame(Update),ctx.fillStyle=Utils.backgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle=Utils.accentColor;for(let e=0;e<canvas.width+50;e+=50)for(let t=0;t<canvas.height+50;t+=50)ctx.beginPath(),ctx.arc(e-25,t-25,2,0,2*Math.PI,!1),ctx.fill();Utils.inputs=[],Utils.outputs=[];for(let t=0;t<Utils.nodes.length;t++){Utils.nodes[t].update();var e=Utils.nodes[t];ctx.font="15px monospace",ctx.fillStyle=Utils.footerTextColor,"Input"==e.title?(ctx.fillText(Utils.letters[Utils.inputs.length],e.x+e.width/2-Utils.getTextWidth(ctx,Utils.letters[Utils.inputs.length])/2,e.y+e.height-7),Utils.inputs.push(e)):"Output"==e.title&&(ctx.fillText(Utils.letters[Utils.outputs.length+13],e.x+e.width/2-Utils.getTextWidth(ctx,Utils.letters[Utils.outputs.length+13])/2,e.y+e.height-7),Utils.outputs.push(e))}Utils.mouse.selecting&&(ctx.fillStyle=Utils.selectColor,ctx.fillRect(Utils.mouse.dragStart.x,Utils.mouse.dragStart.y,Utils.mouse.x-Utils.mouse.dragStart.x,Utils.mouse.y-Utils.mouse.dragStart.y));for(let t=0;t<Utils.nodes.length;t++);}function GenerateTruthTable(){var s=[];for(let t=0;t<Utils.inputs.length;t++)Utils.inputs[t].widgets[0].off();for(let t=0;t<Utils.nodes.length;t++)Utils.nodes[t].update();for(let t=0;t<Utils.nodes.length;t++)Utils.nodes[t].update();for(let e=0;e<Math.pow(2,Utils.inputs.length);e++){var l=[];for(let t=0;t<Utils.inputs.length;t++){var i=Utils.inputs[t];0!=(e&1<<t)?i.widgets[0].on():i.widgets[0].off()}for(let t=0;t<Utils.nodes.length;t++)Utils.nodes[t].update();for(let t=0;t<Utils.nodes.length;t++)Utils.nodes[t].update();for(let t=0;t<Utils.inputs.length;t++){var n=Utils.inputs[t];l.push(n.widgets[0].powered)}for(let t=0;t<Utils.outputs.length;t++){var o=Utils.outputs[t];l.push(o.inputs[0].powered)}s.push(l)}var e=document.getElementById("truth-table"),d=(e.innerHTML="",document.createElement("tr"));for(let t=0;t<Utils.inputs.length;t++){var u=document.createElement("td");u.innerText=Utils.letters[t],d.appendChild(u)}for(let t=0;t<Utils.outputs.length;t++){var r=document.createElement("td");r.innerText=Utils.letters[t+16],d.appendChild(r)}e.appendChild(d);for(let t=0;t<s.length;t++){var a=s[t],c=document.createElement("tr");for(let t=0;t<a.length;t++){var U=document.createElement("td");U.innerText=a[t]?"1":"0",U.className=a[t]?"tt-1":"tt-0",c.appendChild(U)}e.appendChild(c)}e.style.display="block",hidett.innerHTML="Hide Truth Table",e.parentNode.style.display="block"}ctx.fillStyle=Utils.backgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height),Update(),canvas.addEventListener("mousemove",function(t){Utils.mouse.x=t.clientX,Utils.mouse.y=t.clientY,Utils.mouse.clicking&&(Utils.mouse.dragging=!0),Utils.mouse.hoveringInput=void 0,Utils.mouse.hoveringOutput=void 0;for(let t=0;t<Utils.nodes.length;t++){var e=Utils.nodes[t];for(let t=0;t<e.inputs.length;t++){var s=e.inputs[t];Utils.circleContainsPoint(Utils.mouse.x,Utils.mouse.y,s.x,s.y,5)&&(Utils.mouse.hoveringInput=s)}for(let t=0;t<e.outputs.length;t++){var l=e.outputs[t];Utils.circleContainsPoint(Utils.mouse.x,Utils.mouse.y,l.x,l.y,5)&&(Utils.mouse.hoveringOutput=l)}}}),canvas.addEventListener("mousedown",function(t){if(2==t.button)Utils.mouse.selecting||(Utils.mouse.dragStart.x=Utils.mouse.x,Utils.mouse.dragStart.y=Utils.mouse.y,Utils.mouse.selecting=!0);else if(Utils.selectingMultiple){Utils.selectingMultiple=!1;for(let t=0;t<Utils.selectedNodes.length;t++)Utils.selectedNodes[t].selected=!1;Utils.selectedNodes=[]}else{Utils.mouse.clicking=!0,Utils.selectedNode&&(Utils.selectedNode.selected=!1,Utils.selectedNode=void 0);for(let t=0;t<Utils.nodes.length;t++){var e=Utils.nodes[t];if(e.contains(Utils.mouse.x,Utils.mouse.y)){(Utils.selectedNode=e).selected=!0;break}}}}),canvas.addEventListener("mouseup",function(t){if(Utils.mouse.clicking=!1,Utils.mouse.dragging=!1,Utils.mouse.draggingNode=null,Utils.mouse.selecting){Utils.mouse.selecting=!1;for(let t=0;t<Utils.nodes.length;t++){var e=Utils.nodes[t];(e.intersects(Utils.mouse.dragStart.x,Utils.mouse.dragStart.y,Utils.mouse.x,Utils.mouse.y)||e.intersects(Utils.mouse.x,Utils.mouse.y,Utils.mouse.dragStart.x,Utils.mouse.dragStart.y)||e.intersects(Utils.mouse.dragStart.x,Utils.mouse.y,Utils.mouse.x,Utils.mouse.dragStart.y)||e.intersects(Utils.mouse.x,Utils.mouse.dragStart.y,Utils.mouse.dragStart.x,Utils.mouse.y))&&(e.selected=!0,Utils.selectedNodes.push(e),Utils.selectingMultiple=!0)}}}),canvas.addEventListener("keydown",function(t){if("Delete"==t.key)if(Utils.selectingMultiple){for(let t=0;t<Utils.selectedNodes.length;t++)Utils.selectedNodes[t].delete();Utils.selectedNodes=[],Utils.selectingMultiple=!1}else Utils.selectedNode&&(Utils.selectedNode.delete(),Utils.selectedNode=void 0)}),window.addEventListener("contextmenu",function(t){t.preventDefault()}),window.onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight};const nodeSelect=document.getElementById("footer");for(let e=0;e<Utils.prebuiltNodes.length;e++){const aa=document.createElement("button");aa.innerText=Utils.prebuiltNodes[e],aa.addEventListener("click",function(t){Utils.CreateNode(ctx,Utils.prebuiltNodes[e])}),nodeSelect.appendChild(aa)}const generate=document.getElementById("generate"),hidett=(generate.addEventListener("click",function(t){GenerateTruthTable()}),document.getElementById("hide-tt")),truthTable=document.getElementById("truth-table");hidett.addEventListener("click",function(t){truthTable.style.display="none"==truthTable.style.display?"block":"none",this.innerHTML="none"==truthTable.style.display?"Show Truth Table":"Hide Truth Table"}),truthTable.style.display="block",hidett.innerHTML="Hide Truth Table";